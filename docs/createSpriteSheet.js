import{BALL_RADIUS,COLORS,STATES,BADGE_RADIUS,INTERVENTION_BADGES,BADGE_COLORS}from"./options.js";import{handwashPct,maskPct,n95Pct}from"./dom.js";const alteredStates=Object.assign({},STATES,{example:"example"}),alteredColors=Object.assign({},COLORS,{example:"#ccc"});function getCombinations(t){var e=[],n=function(t=[],s){for(var o=0;o<s.length;o++)e.push([...t,s[o]]),n([...t,s[o]],s.slice(o+1))};return n("",t),e}const spriteSize=2*(BALL_RADIUS+BADGE_RADIUS),angleStep=2*Math.PI/INTERVENTION_BADGES.length,badgePositions=INTERVENTION_BADGES.map((t,e)=>{const n=e*angleStep-Math.PI;return[BALL_RADIUS*Math.cos(n),BALL_RADIUS*Math.sin(n)]}),combos=getCombinations(INTERVENTION_BADGES);combos.unshift([]);const createSpriteSheet=t=>{const e=document.createElement("canvas");e.width=combos.length*spriteSize,e.height=Object.keys(alteredStates).length*spriteSize;const n=e.getContext("2d"),s={};for(let t=0;t<Object.keys(alteredStates).length;t++)for(let e=0;e<combos.length;e++){const o=Object.keys(alteredStates)[t],a=combos[e],i=BALL_RADIUS,r=t*spriteSize,S=e*spriteSize,c=BALL_RADIUS+BADGE_RADIUS;n.fillStyle=alteredColors[o],n.beginPath(),n.arc(S+c,r+c,i,0,2*Math.PI),n.fill();for(let t=0;t<a.length;t++){const e=INTERVENTION_BADGES.indexOf(a[t]),[s,o]=badgePositions[e],i=BADGE_COLORS[e];n.fillStyle=i,n.beginPath(),n.arc(S+c+s,r+c+o,BADGE_RADIUS,0,2*Math.PI),n.fill()}let l=o;a.length>0&&(l+="-"+a.join("-")),s[l]=[S,r,spriteSize,spriteSize]}function o(){const t=document.createElement("canvas");return t.width=2*(BALL_RADIUS+BADGE_RADIUS),t.height=2*(BALL_RADIUS+BADGE_RADIUS),t}const a=["handwash","mask","n95"],i=[handwashPct,maskPct,n95Pct];for(let t=0;t<a.length;t++){const n=i[t].parentNode,r=o();r.getContext("2d").drawImage(e,...s["example-"+a[t]],0,0,r.width,r.height),r.style.marginRight="4px",n.prepend(r)}t.sprite=e,t.sprite_lookup=s};export default createSpriteSheet;
