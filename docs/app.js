import{BALL_RADIUS,DESKTOP_CANVAS_SIZE,STARTING_BALLS,RUN,STATIC_PEOPLE_PERCENTATGE,STATES,DEFAULT_INTERVENTION_PARAMETERS}from"./options.js";import{replayButton,runNowButton,maskPct,handwashPct,n95Pct,baselineR0,testFrequency,testPct,emergencyLockdown,socialDistancePct}from"./dom.js";import{Ball}from"./Ball.js";import createSpriteSheet from"./createSpriteSheet.js";import{resetValues,updateCount}from"./results.js";let balls=[];const matchMedia=window.matchMedia("(min-width: 800px)");let isDesktop=matchMedia.matches;export const Canvas=new window.p5(t=>{const e=e=>{let a=0;balls=[],Object.keys(STARTING_BALLS).forEach(e=>{Array.from({length:STARTING_BALLS[e]},()=>{const E=!RUN.filters.stayHome||(t.random(0,100)<STATIC_PEOPLE_PERCENTATGE||e===STATES.infected);balls[a]=new Ball({id:a,sketch:t,state:e,hasMovement:E,x:t.random(BALL_RADIUS,t.width-BALL_RADIUS),y:t.random(BALL_RADIUS,t.height-BALL_RADIUS)}),a++})})},a=()=>{const{height:e,width:a}=DESKTOP_CANVAS_SIZE;t.createCanvas(a,e)};t.setup=()=>{a(),createSpriteSheet(t),e(),matchMedia.addListener(t=>{isDesktop=t.matches,a(),e(),resetValues()}),runNowButton.onclick=()=>{e(),resetValues()},replayButton.onclick=()=>{e(),resetValues()},baselineR0.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.baselineR0=parseFloat(t.target.value)},baselineR0.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.baselineR0.toString()),emergencyLockdown.onchange=()=>{DEFAULT_INTERVENTION_PARAMETERS.emergencyLockdown=emergencyLockdown.checked},emergencyLockdown.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.emergencyLockdown),maskPct.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.maskPct=parseInt(t.target.value)},maskPct.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.maskPct.toString()),handwashPct.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.handwashPct=parseInt(t.target.value)},handwashPct.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.handwashPct.toString()),socialDistancePct.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.socialDistancePct=parseInt(t.target.value)},socialDistancePct.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.socialDistancePct.toString()),n95Pct.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.n95Pct=parseInt(t.target.value)},n95Pct.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.n95Pct.toString()),testFrequency.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.testFrequency=parseInt(t.target.value)},testFrequency.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.testFrequency.toString()),testPct.onchange=t=>{DEFAULT_INTERVENTION_PARAMETERS.testPct=parseInt(t.target.value)},testPct.setAttribute("value",DEFAULT_INTERVENTION_PARAMETERS.testPct.toString())},t.draw=()=>{t.background("white"),balls.forEach(t=>{t.checkState(),t.maybeTest(),t.checkCollisions({others:balls}),t.move(),t.render()}),updateCount()}},document.getElementById("canvas"));
